<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة البريد - محاكم المملكة</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-landmark"></i> نظام البريد</h1>
            </div>
            <nav class="sidebar-nav">
                <a href="#" id="nav-main" class="active"><i class="fas fa-home fa-fw"></i> الرئيسية (البريد الوارد)</a>
                <a href="#" id="nav-add-mail"><i class="fas fa-plus-circle fa-fw"></i> إضافة بريد جديد</a>
                <a href="#" id="nav-search"><i class="fas fa-search fa-fw"></i> بحث شامل (وارد وصادر)</a>
            </nav>
        </aside>

        <div class="main-wrapper">
            <header class="app-header">
                <div class="header-title">
                    <h2>نظام إدارة البريد - محاكم المملكة</h2>
                </div>
                <div class="stats-cards">
                    <div class="stat-card">
                        <h4>مجموع البريد</h4>
                        <p id="stats-total-count">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>البريد الوارد</h4>
                        <p id="stats-incoming-count">0</p>
                    </div>
                    <div class="stat-card">
                        <h4>البريد الصادر</h4>
                        <p id="stats-outgoing-count">0</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="export-excel-button" class="btn btn-export"><i class="fas fa-file-excel"></i> تصدير Excel</button>
                    <button id="save-path-button" class="btn btn-save"><i class="fas fa-save"></i> اختر مسار الحفظ</button>
                </div>
            </header>

            <main class="content-area">
                
                <div id="view-main" class="content-view active">
                    <section class="content-panel">
                        <h2><i class="fas fa-inbox"></i> البريد الوارد</h2>
                        <input type="text" id="search-incoming" class="search-input" placeholder="ابحث في البريد الوارد...">
                        <div class="table-container">
                            <table id="incoming-table">
                                <thead>
                                    <tr>
                                        <th>محكمة</th>
                                        <th>PPR</th>
                                        <th>رقم التسجيل</th>
                                        <th>تاريخ الإتصال</th>
                                        <th>اسم الموظف</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </section>
                </div>

                <div id="view-add-mail" class="content-view">
                    <section class="content-panel">
                        <h2><i class="fas fa-edit"></i> إضافة / تعديل بريد</h2>
                        <form id="mail-form">
                            <div class="form-group-full">
                                <label for="mail-type-select">نوع البريد:</label>
                                <select id="mail-type-select" required>
                                    <option value="">-- اختر نوع البريد --</option>
                                    <option value="incoming">بريد وارد</option>
                                    <option value="outgoing">بريد صادر</option>
                                </select>
                            </div>

                            <div id="incoming-fields-container" class="hidden form-grid-container">
                                <input type="text" id="incoming-court" placeholder="محكمة">
                                <input type="text" id="incoming-ppr" placeholder="PPR">
                                <input type="text" id="incoming-reg-number" placeholder="رقم التسجيل">
                                <input type="date" id="incoming-contact-date">
                                
                                <input type="text" id="incoming-institution-type" placeholder="نوع المؤسسة (اكتب 'ديمومة' لإظهار الحقول الإضافية)">
                                
                                <input type="text" id="incoming-employee-name" placeholder="اسم الموظف">
                                
                                <div id="debt-fields-container" class="hidden form-grid-container" style="grid-column: 1 / -1; background: #f9f9f9; padding: 1rem; border-radius: 6px;">
                                    <input type="text" id="incoming-debt-period" placeholder="فترة المديونية">
                                    <input type="number" id="incoming-entry-year" placeholder="سنة الدخولية">
                                </div>

                                <input type="text" id="incoming-increase-structure" placeholder="بنية الزيادة">
                                <input type="number" id="incoming-count" placeholder="عدد البريد الوارد">
                                <input type="date" id="incoming-edit-date">
                                <select id="responsible-employee">
                                    <option value="">اختر الموظف المسؤول</option>
                                    <option value="موظف 1">موظف 1</option>
                                    <option value="موظف 2">موظف 2</option>
                                    <option value="موظف 3">موظف 3</option>
                                </select>
                                
                                <div class="form-group-full" style="grid-column: 1 / -1; border-top: 1px dashed var(--border-color); padding-top: 1rem; margin-top: 1rem;">
                                    <input type="checkbox" id="incoming-link-to-outgoing-check">
                                    <label for="incoming-link-to-outgoing-check">مرتبط ببريد صادر؟ (اختياري)</label>
                                    
                                    <div id="incoming-link-to-outgoing-container" class="hidden autocomplete-wrapper" style="margin-top: 0.5rem;">
                                        <label for="incoming-link-to-outgoing-search">ابحث عن البريد الصادر (برقم الارسالية):</label>
                                        <input type="text" id="incoming-link-to-outgoing-search" placeholder="ابحث برقم الارسالية...">
                                        <div id="outgoing-autocomplete-results" class="autocomplete-results"></div>
                                    </div>
                                </div>
                                <div class="json-import-container">
                                    <input type="checkbox" id="import-json-check">
                                    <label for="import-json-check">جلب معلومات من ملف JSON</label>
                                    <input type="file" id="json-file-input" accept=".json" style="display: none;">
                                </div>
                            </div>

                            <div id="outgoing-fields-container" class="hidden form-grid-container">
                                <input type="text" id="outgoing-dispatch-number" placeholder="رقم الارسالية">
                                <input type="date" id="outgoing-dispatch-date">
                                <input type="number" id="outgoing-count" placeholder="عدد البريد الصادر">
                                <input type="text" id="outgoing-subject" placeholder="الموضوع">
                                <input type="text" id="outgoing-documents-link" placeholder="رابط الوثائق">
                                
                                <div class="autocomplete-wrapper" style="grid-column: 1 / -1;">
                                    <label for="outgoing-reply-to">رد على بريد وارد (ابحث برقم التسجيل):</label>
                                    <input type="text" id="outgoing-reply-to" placeholder="ابحث عن البريد الوارد (رقم التسجيل)..." required>
                                    <div id="incoming-autocomplete-results" class="autocomplete-results"></div>
                                </div>
                                </div>
                            
                            <button type="submit" class="btn-submit" id="submit-mail-button" style="display: none;">إضافة</button>
                        </form>
                    </section>
                </div>

                <div id="view-search" class="content-view">
                    
                    <section class="content-panel">
                        <h2><i class="fas fa-filter"></i> فلاتر البحث</h2>
                        <div id="global-search-filters">
                            <div>
                                <label for="search-date-from">من تاريخ:</label>
                                <input type="date" id="search-date-from">
                            </div>
                            <div>
                                <label for="search-date-to">إلى تاريخ:</label>
                                <input type="date" id="search-date-to">
                            </div>
                            <div>
                                <label for="search-type">نوع البريد:</label>
                                <select id="search-type">
                                    <option value="">الكل</option>
                                    <option value="incoming">وارد فقط</option>
                                    <option value="outgoing">صادر فقط</option>
                                </select>
                            </div>
                            <div>
                                <label for="search-court-name">المحكمة (للوارد):</label>
                                <input type="text" id="search-court-name" placeholder="ابحث باسم المحكمة...">
                            </div>
                        </div>
                    </section>
                    <section class="content-panel">
                        <h2><i class="fas fa-inbox"></i> البريد الوارد</h2>
                        <input type="text" id="search-incoming-global" class="search-input" placeholder="ابحث في البريد الوارد (كلمة مفتاحية)...">
                        <div class="table-container">
                            <table id="incoming-table-global">
                                <thead>
                                    <tr>
                                        <th>محكمة</th>
                                        <th>PPR</th>
                                        <th>رقم التسجيل</th>
                                        <th>تاريخ الإتصال</th>
                                        <th>اسم الموظف</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </section>
                    <section class="content-panel">
                        <h2><i class="fas fa-paper-plane"></i> البريد الصادر</h2>
                        <input type="text" id="search-outgoing-global" class="search-input" placeholder="ابحث في البريد الصادر (كلمة مفتاحية)...">
                        <div class="table-container">
                            <table id="outgoing-table-global">
                                <thead>
                                    <tr>
                                        <th>رقم الارسالية</th>
                                        <th>تاريخ الارسال</th>
                                        <th>الموضوع</th>
                                        <th>رد على</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </section>
                    
                    <button id="global-search-button" class="btn-submit" style="width: 100%; padding: 1rem; font-size: 1.2rem; margin-top: -1rem;">
                        <i class="fas fa-search"></i> تطبيق البحث والفلاتر
                    </button>

                </div>

            </main>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="navigation.js"></script> </body>
</html>